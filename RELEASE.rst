RELEASE_TYPE: patch

This patch contains some internal refactoring so that we can run
with warnings as errors in CI.
